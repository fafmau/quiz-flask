{% extends "base.html" %}

{% block content %}
<h2>Bloc terminé !</h2>
<p>{{ message }}</p>

{% if remaining_questions > 0 %}
  <p>Il vous reste {{ remaining_questions }} question{{ 's' if remaining_questions > 1 else '' }} en réserve.</p>
  <a class="btn" href="{{ url_for('start_quiz') }}">Continuer</a>
{% else %}
  <p>Vous avez répondu à toutes les questions disponibles.</p>
  <a class="btn" href="{{ url_for('home') }}">Retour à l'accueil</a>
{% endif %}

<h3>Classement</h3>
<table>
  <thead>
    <tr>
      <th>Classement</th>
      <th>Pseudo</th>
      <th>Points</th>
      <th>Questions répondues</th>
      <th>% bonnes réponses</th>
    </tr>
  </thead>
  <tbody>
    {% set current_in_top = false %}
    {% for idx, entry in enumerate(leaderboard[:10], 1) %}
      {% if session.get('pseudo') == entry.name %}
        {% set current_in_top = true %}
      {% endif %}
      <tr class="{% if session.get('pseudo') == entry.name %}current-player{% endif %}">
        <td>{{ idx }}</td>
        <td>{{ entry.name }}</td>
        <td>{{ entry.score }}</td>
        <td>{{ entry.total_questions }}</td>
        <td>{{ entry.percentage }}%</td>
      </tr>
    {% endfor %}

    {% if not current_in_top %}
      {% for idx, entry in enumerate(leaderboard, 1) %}
        {% if session.get('pseudo') == entry.name %}
          <tr class="current-player">
            <td>{{ idx }}</td>
            <td>{{ entry.name }}</td>
            <td>{{ entry.score }}</td>
            <td>{{ entry.total_questions }}</td>
            <td>{{ entry.percentage }}%</td>
          </tr>
        {% endif %}
      {% endfor %}
    {% endif %}
  </tbody>
</table>

{% endblock %}
